---
title: "Stat 464 HW8"
author: "Nicholas Way"
date: "2024-03-22"
output: html_document
---

I used ChatGPT to help me write some of the code

### Front Matter
```{r}
rm(list = ls())
library(ggplot2)
library(tidyverse)
library(BSDA)
library(haven)
library(lmPerm)
library(stats)
```

```{r}
Hay = read.table("C:/Users/nicho/OneDrive - The Pennsylvania State University/Stat 464/Homework/hay-1.dat", header=T, sep="\t", fill = TRUE)

Soy = read.table("C:/Users/nicho/OneDrive - The Pennsylvania State University/Stat 464/Homework/soybean-1.dat", header=T, sep="\t", fill = TRUE)
```

# Question 1
### Friedmans test

k = 12
b = 3

Ranks

T   Block 1, Block 2, Block 3, Rank Mean

1.  4         7       8.5      19.5/3
2.  10        7       7        24/3
3.  5         1.5     5        11.5/3
4.  1         3.5     1        5.5/3
5.  3         1.5     12       16.5/3
6.  2         7       2        11/3
7.  12        7       10.5     29.5/3
8.  10        11      10.5     31.5/3
9.  7         11      6        24/3
10.  8        3.5     4        15.5/3
11.  6        7       8.5      21.5/3
12.  10       11      3        24/3

FM = 12b/k(k+1) sum[i=1,k](Ri.bar - (k+1)/2)^2
(k+1)/2 = 13/2


i (Ri.bar - (k+1)/2)^2
1. 0
2. 2.25
3. 7.111
4. 21.777
5. 1
6. 8.027
7. 11.111
8. 16
9. 2.25
10. 1.777
11. 0.444
12. 2.25

sum[i=1,k](Ri.bar - (k+1)/2)^2 =~ 73.997

12b/k(k+1) = 0.23076923076
0.2307 * 73.997 =~ 17.076

Large sample approximation is chi square[2,k-1]

The P-Value is .105648. The result is not significant at p < .05.

# Question 2
### Friedmans test

k = 5
b = 3

Ranks

T   Block 1, Block 2, Block 3, Rank Mean

36.   3      4        5        12/3
54.   5      5        4        14/3
72.   4      3        2        9/3
108.  1      1        3        5/3
144.  2      2        1        5/3


FM = 12b/k(k+1) sum[i=1,k](Ri.bar - (k+1)/2)^2
(k+1)/2 = 6/2 = 3


i (Ri.bar - (k+1)/2)^2
36. 1
54. 2.777
72. 0
108. 1.777
144. 1.777


sum[i=1,k](Ri.bar - (k+1)/2)^2 =~ 7.331

12b/k(k+1) = 1.2
1.2 * 7.331 =~ 8.7972

Large sample approximation is chi square[2,k-1]

The P-Value is .066373. The result is not significant at p < .05.

# Question 3
## part a
### Permutation

```{r}
Hay_long <- Hay %>%
  pivot_longer(cols = -Date,  
               names_to = "Block",
               values_to = "Yield") %>%
  mutate( Date = as.factor(Date),  
          Block = factor(gsub("Blk", "", Block)))
```

```{r}
perm_result <- aovp(Yield ~ Date + Error(Block), data = Hay_long)

summary(perm_result)
```

The p value = .1859, which is greater than .05, therefore we fail to reject the null hypothesis.

## part b
### Anova

```{r}
anova_result <- aov(Yield ~ Date + Error(Block), data = Hay_long)

summary(anova_result)
```

The p value = 0.0129, which is less than .05, therefore we reject the null hypothesis.

## part c
### Friedmans test

```{r}
friedman_test <- friedman.test(Yield ~ Date | Block, data = Hay_long)

friedman_test

mean_ranks <- Hay_long %>%
  group_by(Date) %>%
  summarize(MeanRank = mean(rank(Yield)))

mean_ranks
```

The p value = 0.1146, which is greater than .05, therefore we fail to reject the null hypothesis. This Friedmans test shows the same insignificant p value as the permutation test in part a.

# Question 4
## part a
### Friedmans test

```{r}
Soy_long <- Soy %>%
  pivot_longer(cols = starts_with("b"), names_to = "Block", values_to = "Score")

friedman_result <- friedman.test(Score ~ Variety | Block, data = Soy_long)

Soy_ranks <- Soy_long %>%
  group_by(Block) %>%
  mutate(Rank = rank(-Score)) 

print(Soy_ranks)

print(friedman_result)
```

The p value = 0.01832, which is less than .05, therefore we reject the null hypothesis.

## part b
### Page's test

```{r}
sum_ranks <- Soy_ranks %>%
  group_by(Variety) %>%
  summarize(TotalRank = sum(Rank)) %>%
  ungroup()


print(sum_ranks)

PG <- sum(sum_ranks$TotalRank * sum_ranks$Variety)


b <- length(unique(Soy_ranks$Block))
k <- length(unique(Soy_ranks$Variety))

E_PG <- b * (k + 1)^2 * k / 4
Var_PG <- b * k^2 * (k + 1)^2 * (k - 1) / 144

Z <- (PG - E_PG) / sqrt(Var_PG)

p_value <- pnorm(Z, lower.tail = FALSE)

PG
E_PG
Var_PG
Z
p_value

```

The p value = 0.00233, which is less than .05, therefore we reject the null hypothesis.

## part c
### Similarities and differences

Friedman's test and Page's test are both non-parametric statistical methods applicable to a randomized complete block design, typically utilized when the assumptions of parametric tests such as ANOVA are not satisfied. They are rank-based tests, which means they are robust to outliers and non-normal data distributions. The key similarity between the two lies in their non-parametric nature and their ability to handle matched subjects data.

Friedman's test is designed to detect any overall differences among multiple treatments without assuming any intrinsic order among them. It tests the null hypothesis that all treatments yield the same effect. As such, it provides a general test for differences and follows a chi-squared distribution under the null hypothesis.

Page's test is employed when there is a hypothesized order or trend among the treatments, such as expecting one treatment to have a greater or lesser effect than another. It specifically tests for a monotonic trendâ€”whether there is a consistent increase or decrease across treatments. Page's test may offer greater statistical power to detect such trends, and its test statistic is standardized to a Z-score that follows a normal distribution in large sample sizes.

In the specific cases of part a and part b, both tests resulted in significance and the rejection of the null hypothesis.



